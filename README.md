# Python VigoBusAPI

Intermediate Python + FastAPI API that provide Stop and Bus information provided by the public transport system of the city of Vigo (Galicia/Spain).

The goal of this API is to keep the different data sources and APIs available on one single API with better endpoints structure and more clear data output format (as JSON).

The API can output Stop information and real-time lists of Buses coming to a certain Stop, with their remaining time in minutes.

---

_API intermedia basada en Python + FastAPI que provee información de Paradas y Autobuses para el sistema de transporte público de la ciudad de Vigo (Galicia/España)._

_El objetivo de esta API es unificar las diferentes fuentes de datos y APIs disponibles en una sóla API con mejor estructura de endpoints y una salida de datos con un formato más claro (como JSON)._

_La API puede devolver información de Paradas y listados en tiempo real de los Autobuses que pasarán por una Parada concreta, con su tiempo restante en minutos._

## Features

- API powered by FastAPI, offering a REST API focused web server, fully async and auto-generating documentation.
- Nice-looking, human-readable & easily-parseable endpoint response output as JSON, compared with original data sources.
- Local data storages: Stop cache, Stop MongoDB, Buses cache; to reduce requests to the external API/data sources.
- Original API/data source fixes in Stop names and Buses lines/routes.
- Environment variables / DotEnv file - based settings system.

---

- _API basada en FastAPI, que ofrece un servidor web orientado a API REST, asíncrono y que auto-genera documentación._
- _Respuestas formateadas como JSON, con mejor estructura, legibles, coherentes y fácilmente procesables, en comparación con los resultados de las fuentes originales._
- _Sistemas de almacenamiento local: caché de Paradas, base de datos MongoDB de Paradas, caché de Autobuses; para así reducir las peticiones a las API/fuentes de datos externas._
- _Arreglo de nombres de Paradas y líneas/rutas de Autobuses en los datos devueltos por las API/fuentes de datos originales._
- _Sistema de configuración basado en variables de entorno / archivo DotEnv._

## Requirements

- Python >= 3.6
- Docker recommended - can be deployed using the [Docker Python Autoclonable App](https://github.com/David-Lor/Docker-Python-Autoclonable-App)
- The packages listed on [requirements.txt](requirements.txt)
- A MongoDB server

---

- _Python >= 3.6_
- _Docker recomendado - puede desplegarse con la imagen [Docker Python Autoclonable App](https://github.com/David-Lor/Docker-Python-Autoclonable-App)_
- _Las dependencias listadas en [requirements.txt](requirements.txt)_
- _Un servidor MongoDB_

## Endpoints

- `/stop/<stop_id>` : Get information about a Stop (name, location), given the Stop ID / _Obtener información de una Parada (nombre, ubicación), dado un código de parada_
- `/buses/<stop_id>` / `/stop/<stop_id>/buses` : Get the Buses that will arrive to a Stop, given the Stop ID / _Obtener los Autobuses que pasarán por una Parada, dado su código de parada_
- `/stops?stop_name=<name>&limit=<limit>` : Search stops by name (optional limit) / _Buscar paradas por nombre (límite opcional)_
- `/stops?stop_id=<id2>&stop_id=<id2>` : Search multiple stops by id in the same request
- `/docs` : Swagger UI (documentation) auto-generated by FastAPI / _Documentación Swagger UI auto-generada por FastAPI_

## Changelog

- 0.8.0 - add new online data source for buses; dotenv settings refactor
- 0.7.1 - set Mongo stop name text index language to spanish
- 0.7.0 - add limit query param to search stops endpoint
- 0.6.1 - add unit tests; fix clear_duplicated_buses function by simplifying logic
- 0.6.0 - add endpoint to search stops by name; get buses extra pages asynchronously
- 0.5.0 - refactor request & error handling, imports & cache; add logging
- 0.4.0 - remove WSDL data sources
- 0.3.3 - remove dotenv-settings-handler as dependency and use pydantic only; remove not required settings; freeze requirements versions
- 0.3.2 - fix buses endpoint returning null source; remove setup.py
- 0.3.1 - store StopNotExist status on local Stop cache
- 0.3.0 - define data models on project (deprecate pybusent)
- 0.2.2 - fix cache bus getter, was returning full list of buses when requesting a minimal list but a full list was cached
- 0.2.1 - fix Stops endpoint, return empty array if no buses available
- 0.2.0 - Migrated to FastAPI, new features, using MongoDB as local storage
- 0.1.0 - Initial release

---

- _0.8.0 - añadida nueva fuente de datos online para buses; refactorización de configuraciones .env_
- _0.7.1 - establecer idioma spanish en text index de paradas guardadas en Mongo_
- _0.7.0 - query param para limitar resultados en endpoint de buscar paradas por nombre_
- _0.6.1 - tests unitarios; arreglada funcinón clear_duplicated_buses simplificando lógica_
- _0.6.0 - endpoint para buscar paradas por nombre; leer páginas extra de buses asíncronamente_
- _0.5.0 - refactorización de request y error handling, imports y cache; añadir sistema de logs_
- _0.4.0 - quitar fuentes de datos WSDL_
- _0.3.3 - quitar la dependencia dotenv-settings-handler y usar sólo pydantic; borrar configuraciones no necesarias; congelar versiones de requirements_
- _0.3.2 - fix endpoint buses devolviendo source null; borrar setup.py_
- _0.3.1 - guardar estado StopNotExist en caché local de Stops_
- _0.3.0 - definición de modelos de datos en proyecto (sin usar pybusent)_
- _0.2.2 - fix cache bus getter, devolvía listado completo de buses cuando se pedía un listado parcial pero uno completo estaba almacenado_
- _0.2.1 - fix endpoint Stops, devolver array vacío si no hay autobuses disponibles_
- _0.2.0 - Migrado a FastAPI, nuevas características, usando MongoDB como almacenamiento local_
- _0.1.0 - Release inicial_

## TODO

- Improve Swagger/OpenAPI documentation
- Add static route information endpoints
- Add Near Stops endpoint
- Add endpoint for static maps and StreetView acquisition
- Add endpoints for static buses info
- Add integration tests
- Add detailed install & configuration instructions

---

- _Mejorar la documentación de Swagger/OpenAPI_
- _Añadir endpoint para consulta de rutas estáticas_
- _Añadir endpoint para consulta de paradas cercanas a ubicación_
- _Añadir endpoint para obtención de mapas estáticos y StreetView_
- _Añadir endpoints para consulta de información estática de buses_
- _Añadir tests de integración_
- _Añadir instrucciones detalladas de instalación y configuración_

## Disclaimer

This project is not endorsed by, directly affiliated with, maintained by, sponsored by or in any way officially connected with the company or companies responsible for the public transport service of the city of Vigo.

---

_Este proyecto no cuenta con soporte, no está afiliado con, mantenido por, patrocinado por ni en cualquier otra manera oficialmente conectado con la compañía o compañías responsables del sistema de transporte público de la ciudad de Vigo._
